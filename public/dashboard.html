<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WD Dashboard</title>

    <style>
        :root {
            --bg-main: #1C1F26;
            --bg-sidebar: #20232D;
            --bg-card: #262A33;
            --bg-table: #242830;
            --border-soft: #323846;
            --accent: #8FB1FF;       /* Soft Blue Premium */
            --accent-soft: #a8c3ff;
            --text-main: #F3F6FF;
            --text-muted: #9CA3AF;
            --danger: #F87171;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--bg-main);
            font-family: Arial, sans-serif;
            color: var(--text-main);
            display: flex;
        }

        /* SIDEBAR */
        .sidebar {
            width: 230px;
            height: 100vh;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border-soft);
            padding-top: 24px;
            position: fixed;
            left: 0;
            top: 0;
        }

        .sidebar h2 {
            text-align: center;
            color: var(--accent-soft);
            margin-bottom: 28px;
            font-size: 20px;
        }

        .menu-item {
            padding: 12px 24px;
            color: var(--text-muted);
            font-size: 14px;
            cursor: pointer;
            transition: 0.2s;
        }

        .menu-item:hover,
        .menu-item.active {
            background: #2b3140;
            color: var(--accent);
            border-left: 3px solid var(--accent);
            padding-left: 21px;
        }

        /* MAIN CONTENT */
        .content {
            margin-left: 230px;
            width: calc(100% - 230px);
            padding: 18px 22px;
        }

        .topbar {
            width: 100%;
            padding: 14px 18px;
            background: var(--bg-sidebar);
            border-radius: 10px;
            border: 1px solid var(--border-soft);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .topbar-title {
            font-size: 18px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .logout-btn {
            padding: 7px 14px;
            background: transparent;
            border-radius: 6px;
            border: 1px solid var(--accent);
            color: var(--accent-soft);
            font-size: 13px;
            cursor: pointer;
            transition: 0.2s;
        }

        .logout-btn:hover {
            background: var(--accent);
            color: #101320;
        }

        /* SUMMARY CARDS */
        .cards {
            display: flex;
            gap: 16px;
            width: 100%;
            margin: 22px 0;
        }

        .card {
            flex: 1;
            padding: 16px 18px;
            background: var(--bg-card);
            border-radius: 10px;
            border: 1px solid var(--border-soft);
        }

        .card h3 {
            margin: 0 0 8px 0;
            color: var(--text-muted);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .card p {
            margin: 0;
            font-size: 22px;
            color: var(--accent-soft);
            font-weight: 600;
        }

        /* TABLE */
        .table-container {
            width: 100%;
            margin: 10px 0;
            background: var(--bg-table);
            border-radius: 10px;
            border: 1px solid var(--border-soft);
            padding: 16px 18px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        thead tr {
            background: #2b3140;
        }

        th {
            padding: 10px 8px;
            text-align: left;
            color: var(--text-muted);
            font-weight: 500;
            border-bottom: 1px solid var(--border-soft);
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid #2f3543;
        }

        tbody tr:hover {
            background: #2a2f3b;
        }

        .loading {
            text-align: center;
            padding: 18px 0;
            color: var(--text-muted);
        }

        .btn-edit {
            padding: 5px 10px;
            background: transparent;
            border-radius: 6px;
            border: 1px solid var(--accent);
            color: var(--accent-soft);
            font-size: 12px;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-edit:hover {
            background: var(--accent);
            color: #101320;
        }

        /* MODAL */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }

        .modal {
            width: 380px;
            background: var(--bg-card);
            border-radius: 10px;
            border: 1px solid var(--border-soft);
            padding: 18px 20px;
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.6);
        }

        .modal h2 {
            margin: 0 0 14px 0;
            font-size: 17px;
        }

        .modal-label {
            font-size: 12px;
            margin-bottom: 4px;
            color: var(--text-muted);
        }

        .modal-input {
            width: 100%;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid var(--border-soft);
            background: #1d2028;
            color: var(--text-main);
            margin-bottom: 12px;
            font-size: 13px;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 8px;
        }

        .btn-cancel {
            padding: 7px 13px;
            background: transparent;
            border-radius: 6px;
            border: 1px solid var(--border-soft);
            color: var(--text-muted);
            font-size: 13px;
            cursor: pointer;
        }

        .btn-save {
            padding: 7px 13px;
            background: var(--accent);
            border-radius: 6px;
            border: 1px solid var(--accent);
            color: #101320;
            font-size: 13px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-save:hover {
            filter: brightness(1.05);
        }

        @media (max-width: 900px) {
            .cards {
                flex-direction: column;
            }

            .sidebar {
                display: none; /* mobile simple aja dulu */
            }

            .content {
                margin-left: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <h2>WD PANEL</h2>
    <div class="menu-item active">Dashboard</div>
    <div class="menu-item">Add WD</div>
    <div class="menu-item">Logs</div>
    <div class="menu-item">Settings</div>
</div>

<!-- MAIN CONTENT -->
<div class="content">

    <div class="topbar">
        <div class="topbar-title">WD Dashboard</div>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <!-- SUMMARY CARDS -->
    <div class="cards">
        <div class="card">
            <h3>Total WD</h3>
            <p id="sum-total">0</p>
        </div>
        <div class="card">
            <h3>Total Amount</h3>
            <p id="sum-amount">Rp 0</p>
        </div>
        <div class="card">
            <h3>Pending</h3>
            <p id="sum-pending">0</p>
        </div>
    </div>

    <!-- TABLE -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Bank</th>
                    <th>Amount</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="list-container">
                <tr><td colspan="5" class="loading">Loading...</td></tr>
            </tbody>
        </table>
    </div>

</div>

<!-- MODAL EDIT -->
<div class="modal-backdrop" id="modal-backdrop">
    <div class="modal">
        <h2>Edit Data WD</h2>

        <div class="modal-label">Username</div>
        <input id="edit-username" class="modal-input" type="text">

        <div class="modal-label">Bank</div>
        <input id="edit-bank" class="modal-input" type="text">

        <div class="modal-label">Amount</div>
        <input id="edit-amount" class="modal-input" type="number" min="0">

        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeModal()">Cancel</button>
            <button class="btn-save" onclick="saveEdit()">Save</button>
        </div>
    </div>
</div>

<script>
let currentEditId = null;
let currentData = [];

function logout() {
    window.location.href = "/"; // balik ke index (login)
}

async function loadData() {
    try {
        const res = await fetch("/api/list", {
            headers: { "x-api-key": "kontolkecap12" }
        });

        const data = await res.json();
        currentData = data;

        const table = document.getElementById("list-container");
        table.innerHTML = "";

        let totalWD = data.length;
        let totalAmount = 0;
        let pending = data.length;

        data.forEach(row => {
            totalAmount += row.amount;

            table.innerHTML += `
                <tr>
                    <td>${row.id}</td>
                    <td>${row.username}</td>
                    <td>${row.bank}</td>
                    <td>Rp ${row.amount.toLocaleString()}</td>
                    <td>
                        <button class="btn-edit" onclick="openEditModal(${row.id})">Edit</button>
                    </td>
                </tr>
            `;
        });

        document.getElementById("sum-total").innerText = totalWD;
        document.getElementById("sum-amount").innerText = "Rp " + totalAmount.toLocaleString();
        document.getElementById("sum-pending").innerText = pending;

    } catch (err) {
        document.getElementById("list-container").innerHTML =
            "<tr><td colspan='5' class='loading'>Gagal load data</td></tr>";
    }
}

function openEditModal(id) {
    currentEditId = id;
    const row = currentData.find(r => r.id === id);
    if (!row) return;

    document.getElementById("edit-username").value = row.username;
    document.getElementById("edit-bank").value = row.bank;
    document.getElementById("edit-amount").value = row.amount;

    document.getElementById("modal-backdrop").style.display = "flex";
}

function closeModal() {
    document.getElementById("modal-backdrop").style.display = "none";
    currentEditId = null;
}

function saveEdit() {
    if (!currentEditId) return;

    const username = document.getElementById("edit-username").value.trim();
    const bank = document.getElementById("edit-bank").value.trim();
    const amount = Number(document.getElementById("edit-amount").value);

    const idx = currentData.findIndex(r => r.id === currentEditId);
    if (idx !== -1) {
        currentData[idx].username = username;
        currentData[idx].bank = bank;
        currentData[idx].amount = amount;
    }

    const table = document.getElementById("list-container");
    table.innerHTML = "";
    let totalWD = currentData.length;
    let totalAmount = 0;
    let pending = currentData.length;

    currentData.forEach(row => {
        totalAmount += row.amount;
        table.innerHTML += `
            <tr>
                <td>${row.id}</td>
                <td>${row.username}</td>
                <td>${row.bank}</td>
                <td>Rp ${row.amount.toLocaleString()}</td>
                <td>
                    <button class="btn-edit" onclick="openEditModal(${row.id})">Edit</button>
                </td>
            </tr>
        `;
    });

    document.getElementById("sum-total").innerText = totalWD;
    document.getElementById("sum-amount").innerText = "Rp " + totalAmount.toLocaleString();
    document.getElementById("sum-pending").innerText = pending;

    closeModal();

    // nanti kalau mau simpan ke backend / DB,
    // di sini bisa ditambah fetch("/api/update", { ... })
}

loadData();
</script>

</body>
</html>
